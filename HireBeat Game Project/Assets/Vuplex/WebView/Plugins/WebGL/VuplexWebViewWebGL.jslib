mergeInto(LibraryManager.library,{$VuplexWebViewImplementation:{},$VuplexWebViewImplementation__postset:`if(typeof Object.assign!="function"){Object.defineProperty(Object,"assign",{value:function e(t){"use strict";if(t==null){throw new TypeError("Cannot convert undefined or null to object")}var n=Object(t);for(var i=1;i<arguments.length;i++){var r=arguments[i];if(r!=null){for(var o in r){if(Object.prototype.hasOwnProperty.call(r,o)){n[o]=r[o]}}}}return n},writable:true,configurable:true})}var System;(function(e){var a={};var u={};function t(e,t,n){u[e]={deps:t,factory:n}}e.register=t;function n(e,t){a[e]=t}e.registerExternal=n;function c(e){if(e in a)return a[e];return i(e)}e.require=c;function l(e){var t=c(e);return Promise.resolve(t)}function i(e){if(!(e in u))throw new Error("Cannot resolve '"+e+"'");var t=u[e];var n={};a[e]=n;function i(e,t){n[e]=t}var r=t.factory(i,{id:e,import:l});for(var o=0;o<t.deps.length;o++){var s=t.deps[o];r.setters[o](c(s))}r.execute();return n}})(System||(System={}));var __spreadArray=this&&this.__spreadArray||function(e,t){for(var n=0,i=t.length,r=e.length;n<i;n++,r++)e[r]=t[n];return e};var __extends=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]};return i(e,t)};return function(e,t){if(typeof t!=="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();System.register("src/Logger",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}e.error=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}console.error.apply(console,__spreadArray([this._formatMessage(e)],t))};e.info=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}console.log.apply(console,__spreadArray([this._formatMessage(e)],t))};e.warn=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}console.warn.apply(console,__spreadArray([this._formatMessage(e)],t))};e._formatMessage=function(e){return"[3D WebView] "+e};return e}();e("default",n)}}});System.register("libs/browser-agent/src/IBridge",[],function(e,t){"use strict";var n=t&&t.id;return{setters:[],execute:function(){}}});System.register("libs/browser-agent/src/utils/EventEmitter",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){n=function(){function e(){this._listeners={}}e.prototype.addListener=function(e,t){if(!this._listeners[e]){this._listeners[e]=[]}if(this._listeners[e].indexOf(t)===-1){this._listeners[e].push(t)}};e.prototype.emit=function(t){var e=[];for(var n=1;n<arguments.length;n++){e[n-1]=arguments[n]}if(!this._listeners[t]){return}for(var i=0,r=this._listeners[t];i<r.length;i++){var o=r[i];try{o.apply(void 0,e)}catch(e){console.error("An error occurred while invoking the '"+t+"' event handler.",e)}}};e.prototype.removeListener=function(e,t){if(!this._listeners[e]){return}var n=this._listeners[e].indexOf(t);if(n!==-1){this._listeners[e].splice(n,1)}};return e}();e("default",n)}}});System.register("libs/browser-agent/src/BaseBridge",["libs/browser-agent/src/utils/EventEmitter"],function(e,t){"use strict";var n,i;var r=t&&t.id;return{setters:[function(e){n=e}],execute:function(){i=function(){function e(){this._eventEmitter=new n.default;this._eventResponseResolveFunctions={}}e.prototype.addEventListener=function(e,t){this._eventEmitter.addListener(e,t)};e.prototype.removeEventListener=function(e,t){this._eventEmitter.removeListener(e,t)};e.prototype.postMessageWithResponse=function(n){var i=this;var r;do{r=Math.random().toString()}while(r in this._eventResponseResolveFunctions);return new window.Promise(function(e,t){i._eventResponseResolveFunctions[r]=e;n=Object.assign({responseId:r},n);setTimeout(t,1e3);i.postMessage(n)}).then(function(e){delete i._eventResponseResolveFunctions[r];return e}).catch(function(){delete i._eventResponseResolveFunctions[r];throw new Error("The native module didn't respond to the event in time.")})};e.prototype._emit=function(e,t){this._eventEmitter.emit(e,t)};e.prototype._respondToEvent=function(e){var t=e.responseId,n=e.value;var i=this._eventResponseResolveFunctions[t];if(i){i(n)}};return e}();e("default",i)}}});System.register("libs/browser-agent/src/IFrameBridge",["libs/browser-agent/src/BaseBridge"],function(e,t){"use strict";var n,i;var r=t&&t.id;return{setters:[function(e){n=e}],execute:function(){i=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.postMessage=function(e){};return t}(n.default);e("default",i)}}});System.register("libs/browser-agent/src/MessageType",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){(function(e){e["FocusedInputFieldChanged"]="vuplex.webview.focusedInputFieldChanged";e["PageTransparencyDetermined"]="vuplex.webview.pageTransparencyDetermined";e["TitleChanged"]="vuplex.webview.titleChanged";e["UrlChanged"]="vuplex.webview.urlChanged"})(n||(n={}));e("default",n)}}});System.register("libs/browser-agent/src/utils/flattenPrototypes",[],function(e,t){"use strict";var n=t&&t.id;function i(e,t){var n,i;while(t.constructor.name!=="Object"){for(var r=0,o=Object.getOwnPropertyNames(t);r<o.length;r++){var s=o[r];var a=Object.getOwnPropertyDescriptor(t,s);if(a.get||a.set){(n=a.get)===null||n===void 0?void 0:n.bind(e);(i=a.set)===null||i===void 0?void 0:i.bind(e)}else{var u=t[s];if(typeof u==="function"&&s!=="constructor"){e[s]=u.bind(e)}}}t=Object.getPrototypeOf(t)}}e("default",i);return{setters:[],execute:function(){}}});System.register("libs/browser-agent/src/UrlActionType",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){(function(e){e["Load"]="LOAD";e["PushState"]="PUSH_STATE";e["ReplaceState"]="REPLACE_STATE";e["HashChange"]="HASH_CHANGE"})(n||(n={}));e("default",n)}}});System.register("libs/browser-agent/src/FocusedInputFieldType",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){(function(e){e["Text"]="TEXT";e["None"]="NONE"})(n||(n={}));e("default",n)}}});System.register("libs/browser-agent/src/isTextInputOrTextarea",[],function(e,t){"use strict";var i;var n=t&&t.id;function r(e,t){if(e instanceof t.HTMLInputElement){var n=i[e.type.toLowerCase()];return!n}return e instanceof t.HTMLTextAreaElement}e("default",r);return{setters:[],execute:function(){i={button:true,checkbox:true,color:true,file:true,hidden:true,image:true,radio:true,range:true,reset:true,submit:true}}}});System.register("libs/browser-agent/src/focusedElementIsEditable",["libs/browser-agent/src/isTextInputOrTextarea"],function(e,t){"use strict";var n;var i=t&&t.id;function r(e){var t=e.document.activeElement;return t&&(n.default(t,e)||t.isContentEditable)}e("default",r);return{setters:[function(e){n=e}],execute:function(){}}});System.register("libs/browser-agent/src/BrowserAgent",["libs/browser-agent/src/utils/EventEmitter","libs/browser-agent/src/IFrameBridge","libs/browser-agent/src/MessageType","libs/browser-agent/src/utils/flattenPrototypes","libs/browser-agent/src/UrlActionType","libs/browser-agent/src/FocusedInputFieldType","libs/browser-agent/src/focusedElementIsEditable"],function(e,t){"use strict";var n,o,s,a,u,c,l,i;var r=t&&t.id;return{setters:[function(e){n=e},function(e){o=e},function(e){s=e},function(e){a=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){i=function(n){__extends(r,n);function r(e,t){var i=n.call(this)||this;i._consoleApiPatched=false;i._consoleMessageEventsEnabled=false;i._focusedInputField=null;i._focusedInputFieldIntervalToken=0;i._isInIframe=parent!==window;i._title="";i._checkFocusedInputField=function(){var e=l.default(i._window);var t=e?i._document.activeElement:null;if(i._focusedInputField!==t){var n=e?c.default.Text:c.default.None;i._focusedInputField=t;i._bridge.postMessage({type:s.default.FocusedInputFieldChanged,value:n})}};i._consoleMessageEventsEnabled=!!(t===null||t===void 0?void 0:t.enableConsoleMessageEvents);i._windowReference=t===null||t===void 0?void 0:t.window;i._patchConsoleApiIfNeeded();a.default(i,r.prototype);if(i._isInIframe){i._bridge=new o.default}else{i._bridge=e}if(i._document.readyState==="loading"||!i._document.head){i._document.addEventListener("DOMContentLoaded",function(){i._performPostDomLoadInitialization(t===null||t===void 0?void 0:t.enableFocusedInputFieldEvents)})}else{i._performPostDomLoadInitialization(t===null||t===void 0?void 0:t.enableFocusedInputFieldEvents)}if(i._isInMainFrame){i._emitUrlChange(u.default.Load);i._watchForUrlChanges()}return i}r.prototype.setConsoleMessageEventsEnabled=function(e){this._consoleMessageEventsEnabled=e;this._patchConsoleApiIfNeeded()};r.prototype.setFocusedInputFieldEventsEnabled=function(e){if(e&&!this._focusedInputFieldIntervalToken){this._focusedInputFieldIntervalToken=this._window.setInterval(this._checkFocusedInputField,200)}};Object.defineProperty(r.prototype,"_document",{get:function(){return this._window.document},enumerable:false,configurable:true});Object.defineProperty(r.prototype,"_window",{get:function(){return this._windowReference||window},enumerable:false,configurable:true});r.prototype._checkForTitleChanges=function(){var e=this._document.title;if(!e||this._title===e){return}this._title=e;this._bridge.postMessage({type:s.default.TitleChanged,value:e})};r.prototype._determinePageTransparency=function(){var e=this._document.head.getElementsByTagName("meta");var t=Array.prototype.filter.call(e,function(e){return e.getAttribute("name")==="transparent"})[0];var n=!!t&&t.getAttribute("content")==="true";this._bridge.postMessage({type:s.default.PageTransparencyDetermined,value:n})};r.prototype._emitUrlChange=function(e){try{var t=this._document.URL;if(t.indexOf("chrome-error://")===0){return}if(t.indexOf("about:")===0){return}if(t.indexOf("ms-local-stream://")===0){return}if(t.indexOf(".pdf?file=")!==-1){return}this._bridge.postMessage({type:s.default.UrlChanged,urlAction:{Url:t,Title:this._document.title,Type:e}})}catch(e){console.error("An error occurred while handling the URL change.",e)}};Object.defineProperty(r.prototype,"_isInMainFrame",{get:function(){return parent===window},enumerable:false,configurable:true});r.prototype._onHashChange=function(){this._emitUrlChange(u.default.HashChange)};r.prototype._onPushState=function(){this._emitUrlChange(u.default.PushState)};r.prototype._onReplaceState=function(){this._emitUrlChange(u.default.ReplaceState)};r.prototype._patchConsoleApiIfNeeded=function(){if(this._consoleApiPatched||!this._consoleMessageEventsEnabled){return}this._consoleApiPatched=true;this._patchConsoleMethod("log","LOG");this._patchConsoleMethod("info","LOG");this._patchConsoleMethod("debug","DEBUG");this._patchConsoleMethod("error","ERROR");this._patchConsoleMethod("warn","WARNING")};r.prototype._patchConsoleMethod=function(e,i){var r=this;var o=this._window.console[e].bind(this._window.console);this._window.console[e]=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(r._consoleMessageEventsEnabled){try{var n=e.map(function(e){return typeof e==="object"&&!(e instanceof r._window.Error)?JSON.stringify(e):e}).join(", ");r._bridge.postMessage({type:"vuplex.webview.consoleMessageLogged",level:i,message:n})}catch(e){}}o.apply(void 0,e)}};r.prototype._performPostDomLoadInitialization=function(e){if(this._isInMainFrame){this._window.setInterval(this._checkForTitleChanges.bind(this),200);this._determinePageTransparency()}if(e){this.setFocusedInputFieldEventsEnabled(true)}};r.prototype._watchForUrlChanges=function(){var i=this;var r=this._window.history.pushState;this._window.history.pushState=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n=r.apply(i._window.history,e);i._onPushState();return n};var o=this._window.history.replaceState;this._window.history.replaceState=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n=o.apply(i._window.history,e);i._onReplaceState();return n};this._window.onhashchange=this._onHashChange.bind(this);this._window.addEventListener("yt-navigate-finish",this._onPushState.bind(this))};return r}(n.default);e("default",i)}}});System.register("libs/browser-agent/src/initBrowserAgent",["libs/browser-agent/src/BrowserAgent"],function(e,t){"use strict";var r;var n=t&&t.id;function i(e,t){var n;var i=((n=t===null||t===void 0?void 0:t.browserAgentOptions)===null||n===void 0?void 0:n.window)||window;if(i.vuplex&&i._vuplexInternal){return}i.vuplex=e;i._vuplexInternal={browserAgent:new r.default(e,t===null||t===void 0?void 0:t.browserAgentOptions)};if(t===null||t===void 0?void 0:t.optionalComponents){Object.assign(i._vuplexInternal,t===null||t===void 0?void 0:t.optionalComponents)}i.dispatchEvent(new Event("vuplexready"))}e("default",i);return{setters:[function(e){r=e}],execute:function(){}}});System.register("libs/browser-agent/src/optional/FocusManager",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){if(e===void 0){e=window}this._activeElementDuringLastBlur=null;this._window=e}e.prototype.setFocused=function(e){if(e){var t=this._activeElementDuringLastBlur||this._document.activeElement;if(t instanceof this._window.HTMLElement){t.focus();this._activeElementDuringLastBlur=null}return}var n=this._document.activeElement;this._activeElementDuringLastBlur=n;if(n instanceof this._window.HTMLElement){n.blur()}};Object.defineProperty(e.prototype,"_document",{get:function(){return this._window.document},enumerable:false,configurable:true});return e}();e("default",n)}}});System.register("libs/browser-agent/src/IFramePostMessageDomain",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){(function(e){e["IFrameBridgeDownstream"]="vuplex.iframeBridgeDownstream";e["IFrameBridgeUpstream"]="vuplex.iframeBridgeUpstream"})(n||(n={}));e("default",n)}}});System.register("libs/browser-agent/src/optional/KeyboardInputManager",["libs/browser-agent/src/isTextInputOrTextarea","libs/browser-agent/src/IFramePostMessageDomain","libs/browser-agent/src/focusedElementIsEditable"],function(e,t){"use strict";var s,i,f,r,n;var o=t&&t.id;return{setters:[function(e){s=e},function(e){i=e},function(e){f=e}],execute:function(){r="vuplex.webview.handleKeyboardInput";n=function(){function e(e){var n=this;this._textInputEventsEnabled=false;this._handleIFrameMessage=function(e){if(!e.data){return}var t=e.data.message;if(e.data.domain===i.default.IFrameBridgeDownstream&&t.type===r){n.handleKeyboardInput(t.input)}};this._window=(e===null||e===void 0?void 0:e.window)||window;this._textInputEventsEnabled=!!(e===null||e===void 0?void 0:e.enableTextInputEvents);this._window.addEventListener("message",this._handleIFrameMessage)}e.prototype.handleKeyboardInput=function(e){if(this._document.activeElement instanceof this._window.HTMLIFrameElement){this._document.activeElement.contentWindow.postMessage({domain:i.default.IFrameBridgeDownstream,message:{type:r,input:e}},"*");return}var t=Array.from(e).length;if(t===1){this._dispatchCharacter(e);return}if(f.default(this._window)&&(e==="ArrowLeft"||e==="ArrowRight")){this._dispatchCharacter(e);return}switch(e){case"ArrowUp":this._window.scrollBy(0,-50);break;case"ArrowDown":this._window.scrollBy(0,50);break;case"ArrowLeft":this._window.scrollBy(-50,0);break;case"ArrowRight":this._window.scrollBy(50,0);break}};Object.defineProperty(e.prototype,"_document",{get:function(){return this._window.document},enumerable:false,configurable:true});e.prototype._dispatchCharacter=function(e){if(e==="\\n"&&this._document.activeElement instanceof this._window.HTMLInputElement){var t=this._getFocusedForm();if(t){t.submit()}else{this._dispatchKeyPressEvents(this._document.activeElement,"\\r")}return}if(this._document.activeElement){this._dispatchKeyPressEvents(this._document.activeElement,e)}var n=this._document.activeElement;if(!f.default(this._window)){return}var i=this._getSelection(n),r=i.selectionStart,o=i.selectionEnd;var s=this._getTextValue(n);if(e==="\\b"){var a=r===o&&r===0;if(a){return}var u=r!==o;if(u){var c=this._spliceString(s,r,o-r,"");this._setTextValue(n,c);this._setSelection(n,r,r)}else{var c=this._spliceString(s,r-1,1,"");this._setTextValue(n,c);var l=r-1;this._setSelection(n,l,l)}}else if(e==="ArrowLeft"){if(r===o){var d=Math.max(r-1,0);this._setSelection(n,d,d)}else{this._setSelection(n,r,r)}}else if(e==="ArrowRight"){if(r===o){var d=Math.min(o+1,s.length);this._setSelection(n,d,d)}else{this._setSelection(n,o,o)}}else{var c=this._spliceString(s,r,o-r,e);this._setTextValue(n,c);var l=r+1;this._setSelection(n,l,l)}};e.prototype._dispatchKeyboardEvent=function(e,t,n){var i=n.charCodeAt(0);var r=new KeyboardEvent(t,{key:n,keyCode:i,bubbles:true});Object.defineProperty(r,"keyCode",{value:i,writable:false});e.dispatchEvent(r)};e.prototype._dispatchKeyPressEvents=function(e,t){this._dispatchKeyboardEvent(e,"keydown",t);this._dispatchKeyboardEvent(e,"keypress",t);if(this._textInputEventsEnabled){var n=this._document.createEvent("TextEvent");n.initTextEvent("textInput",true,true,this._window,t,0,"en-US");e.dispatchEvent(n)}this._dispatchKeyboardEvent(e,"keyup",t)};e.prototype._getFocusedForm=function(){var e=this._document.activeElement||null;while(e){if(e instanceof this._window.HTMLFormElement){return e}e=e.parentElement}return null};e.prototype._getSelection=function(e){if(s.default(e,this._window)){return{selectionStart:e.selectionStart||0,selectionEnd:e.selectionEnd||0}}var t=this._window.getSelection();if(t&&t.rangeCount){var n=t.getRangeAt(0);if(n.commonAncestorContainer.parentNode==e){return{selectionStart:n.startOffset,selectionEnd:n.endOffset}}}return{selectionStart:0,selectionEnd:0}};e.prototype._getTextValue=function(e){if(s.default(e,this._window)){return e.value}return e.innerText||""};e.prototype._setSelection=function(e,t,n){if(s.default(e,this._window)){e.setSelectionRange(t,n);return}var i=this._document.createRange();var r=this._window.getSelection();var o=e.childNodes[0];i.setStart(o,t);i.setStart(o,n);if(r){r.removeAllRanges();r.addRange(i)}};e.prototype._setTextValue=function(e,t){if(e instanceof this._window.HTMLInputElement){Object.getOwnPropertyDescriptor(this._window.HTMLInputElement.prototype,"value").set.call(e,t)}else if(e instanceof this._window.HTMLTextAreaElement){Object.getOwnPropertyDescriptor(this._window.HTMLTextAreaElement.prototype,"value").set.call(e,t)}else{e.innerText=t}e.dispatchEvent(new Event("input",{bubbles:true}))};e.prototype._spliceString=function(e,t,n,i){return e.slice(0,t)+i+e.slice(t+Math.abs(n))};return e}();e("default",n)}}});System.register("libs/browser-agent/src/optional/PointerInputManager",["libs/browser-agent/src/IFramePostMessageDomain","libs/browser-agent/src/utils/flattenPrototypes"],function(e,t){"use strict";var l,r,s,d,f,o,p,n;var i=t&&t.id;return{setters:[function(e){l=e},function(e){r=e}],execute:function(){s="vuplex.webview.movePointer";d="vuplex.webview.pointerDown";f="vuplex.webview.pointerUp";o="vuplex.webview.click";(function(e){e[e["Left"]=0]="Left";e[e["Right"]=1]="Right";e[e["Middle"]=2]="Middle";e[e["None"]=3]="None"})(p||(p={}));n=function(){function i(e,t){var n=this;if(t===void 0){t=false}this._buttonDown=p.None;this._handleIframeMessage=function(e){if(!e.data){return}var t=e.data.message;if(e.data.domain===l.default.IFrameBridgeDownstream){switch(t.type){case s:n.movePointer(t.x,t.y);break;case d:n.pointerDown(t.x,t.y,t.mouseButton,t.clickCount);break;case f:n.pointerUp(t.x,t.y,t.mouseButton,t.clickCount);break;case o:n.click(t.x,t.y);break}}};this._windowReference=e;this._isIOS=t;r.default(this,i.prototype);this._window.addEventListener("message",this._handleIframeMessage)}i.prototype.click=function(e,t){this.pointerDown(e,t,p.Left,1);this.pointerUp(e,t,p.Left,1)};i.prototype.movePointer=function(e,t){var n=this._document.elementFromPoint(e,t);if(!n){return}if(n instanceof this._window.HTMLIFrameElement&&n.contentWindow){var i=n.getBoundingClientRect();var r=e-i.left;var o=t-i.top;n.contentWindow.postMessage({domain:l.default.IFrameBridgeDownstream,message:{type:s,x:r,y:o}},"*");return}this._dispatchPointerEvent(n,"pointermove",e,t,this._buttonDown,0);this._dispatchPointerEvent(n,"mousemove",e,t,this._buttonDown,0);if(this._lastMouseOverElement!==n){this._lastMouseOverElement=n;this._dispatchPointerEvent(n,"pointerover",e,t,this._buttonDown,0);this._dispatchPointerEvent(n,"mouseover",e,t,this._buttonDown,0)}};i.prototype.pointerDown=function(e,t,n,i){var r=this._document.elementFromPoint(e,t);if(!r){return}if(r instanceof this._window.HTMLIFrameElement&&r.contentWindow){var o=r.getBoundingClientRect();var s=e-o.left;var a=t-o.top;r.contentWindow.postMessage({domain:l.default.IFrameBridgeDownstream,message:{type:d,x:s,y:a,mouseButton:n,clickCount:i}},"*");return}var u=this._getParent(r,["a","button"]);var c=u||r;this.movePointer(e,t);this._buttonDown=n;this._dispatchPointerEvent(c,"pointerdown",e,t,n,i);if(!(this._isIOS&&r instanceof this._window.HTMLSelectElement)){this._dispatchPointerEvent(c,"mousedown",e,t,n,i)}};i.prototype.pointerUp=function(e,t,n,i){var r=this._document.elementFromPoint(e,t);if(!r){return}if(r instanceof this._window.HTMLIFrameElement&&r.contentWindow){var o=r.getBoundingClientRect();var s=e-o.left;var a=t-o.top;r.contentWindow.postMessage({domain:l.default.IFrameBridgeDownstream,message:{type:f,x:s,y:a,mouseButton:n,clickCount:i}},"*");return}var u=this._getParent(r,["a","button"]);var c=u||r;if(this._isIOS&&c instanceof this._window.HTMLSelectElement){c.dispatchEvent(new FocusEvent("focus",{bubbles:true,cancelable:true}))}else if(c instanceof this._window.HTMLElement){c.focus()}this._dispatchPointerEvent(c,"pointerup",e,t,n,i);this._dispatchPointerEvent(c,"mouseup",e,t,n,i);if(this._instanceof(c,[this._window.HTMLAnchorElement,this._window.HTMLButtonElement,this._window.HTMLInputElement])){c.click()}else{this._dispatchPointerEvent(c,"click",e,t,n,i)}if(i===2){this._dispatchPointerEvent(c,"dblclick",e,t,n,i)}this._buttonDown=p.None};Object.defineProperty(i.prototype,"_document",{get:function(){return this._window.document},enumerable:false,configurable:true});Object.defineProperty(i.prototype,"_window",{get:function(){return this._windowReference||window},enumerable:false,configurable:true});i.prototype._convertMouseButtonToPointerEventButton=function(e){switch(e){case p.Left:return 0;case p.Right:return 2;case p.Middle:return 1;case p.None:default:return 0}};i.prototype._convertMouseButtonToPointerEventButtons=function(e){switch(e){case p.Left:return 1;case p.Right:return 2;case p.Middle:return 4;case p.None:default:return 0}};i.prototype._dispatchPointerEvent=function(e,t,n,i,r,o){var s=t.indexOf("up")!==-1||t.indexOf("click")!==-1;var a=s?0:this._convertMouseButtonToPointerEventButton(r);var u=s?0:this._convertMouseButtonToPointerEventButtons(r);var c=new PointerEvent(t,{bubbles:true,cancelable:true,screenX:n,screenY:i,clientX:n,clientY:i,button:a,buttons:u,pointerId:1,pointerType:"mouse",detail:o,isPrimary:true});e.dispatchEvent(c)};i.prototype._getParent=function(e,t){for(var n=0,i=t;n<i.length;n++){var r=i[n];if(e.tagName===r.toUpperCase()&&e instanceof this._window.HTMLElement){return e}}if(e===this._document.documentElement){return null}var o=e.parentElement;if(!o){return null}return this._getParent(o,t)};i.prototype._instanceof=function(e,t){for(var n=0,i=t;n<i.length;n++){var r=i[n];if(e instanceof r){return true}}return false};return i}();e("default",n)}}});System.register("libs/browser-agent/src/optional/ScrollManager",["libs/browser-agent/src/IFramePostMessageDomain"],function(e,t){"use strict";var _,w,g,n;var i=t&&t.id;return{setters:[function(e){_=e}],execute:function(){w="vuplex.webview.scrollAtPoint";g="vuplex.webview.iframeUnscrollable";n=function(){function e(e){var s=this;if(e===void 0){e=window}this._handleIFrameMessage=function(t){if(!t.data){return}var e=t.data.message;if(t.data.domain===_.default.IFrameBridgeDownstream){if(e.type===w){s.scrollAtPoint(e.deltaX,e.deltaY,e.pointerX,e.pointerY)}}else if(t.data.domain===_.default.IFrameBridgeUpstream){if(e.type===g){var n=Array.from(s._document.getElementsByTagName("iframe")).find(function(e){return e.contentWindow===t.source});if(!n){return}var i=n.getBoundingClientRect();var r=i.left+e.pointerX;var o=i.top+e.pointerY;s.scrollAtPoint(e.deltaX,e.deltaY,r,o,true)}}};this._window=e;this._window.addEventListener("message",this._handleIFrameMessage)}e.prototype.scrollAtPoint=function(e,t,n,i,r){if(r===void 0){r=false}if(e===0&&t===0){return}var o;var s=false;while(!(o===this._document.scrollingElement||o instanceof this._window.HTMLIFrameElement&&!r||s)){o=o?o.parentElement:this._document.elementFromPoint(n,i)||this._document.scrollingElement;if(!o){break}if(o.tagName==="VUPLEX-DROPDOWN-CONTAINER"){return}if(Math.abs(t)>Math.abs(e)){var a=false;if(t>0){var u=o.scrollHeight-(o.scrollTop+o.clientHeight);a=u>0}else{var c=o.scrollTop;a=c>0}s=a&&["scroll","auto"].indexOf(this._window.getComputedStyle(o).overflowY)!==-1}else{var a=false;if(e>0){var l=o.scrollWidth-(o.scrollLeft+o.clientWidth);a=l>0}else{var d=o.scrollLeft;a=d>0}s=a&&["scroll","auto"].indexOf(this._window.getComputedStyle(o).overflowX)!==-1}}if(o&&o instanceof this._window.HTMLIFrameElement&&o.contentWindow&&!r){var f=o.getBoundingClientRect();var p=n-f.left;var h=i-f.top;o.contentWindow.postMessage({domain:_.default.IFrameBridgeDownstream,message:{type:w,deltaX:e,deltaY:t,pointerX:p,pointerY:h}},"*")}else if(o){var v=parent!==window;if(v&&!s){parent.postMessage({domain:_.default.IFrameBridgeUpstream,message:{type:g,deltaX:e,deltaY:t,pointerX:n,pointerY:i}},"*");return}if(this._window.getComputedStyle(o).scrollBehavior==="smooth"){o.style.scrollBehavior="auto"}o.scrollTop+=t;o.scrollLeft+=e;if(o===this._document.body&&this._document.scrollingElement&&this._document.scrollingElement!==this._document.body){this._document.scrollingElement.scrollTop+=t;this._document.scrollingElement.scrollLeft+=e}}else{this._window.scrollBy(e,t)}};Object.defineProperty(e.prototype,"_document",{get:function(){return this._window.document},enumerable:false,configurable:true});return e}();e("default",n)}}});System.register("src/WebGLBridge",["libs/browser-agent/src/BaseBridge"],function(e,t){"use strict";var n,i,r;var o=t&&t.id;return{setters:[function(e){n=e}],execute:function(){e("POST_MESSAGE_MESSAGE_TYPE",i="vuplex.postMessage");r=function(t){__extends(e,t);function e(e){var n=t.call(this)||this;n._handleWindowMessage=function(e){var t;if(((t=e.data)===null||t===void 0?void 0:t.type)===i){n._emit("message",{data:e.data.message})}};e.addEventListener("message",n._handleWindowMessage);return n}e.prototype.postMessage=function(e){var t=typeof e==="string"?e:JSON.stringify(e);parent.postMessage({type:i,message:t},"*")};return e}(n.default);e("default",r)}}});System.register("src/WebGLWebView",["src/Logger","libs/browser-agent/src/initBrowserAgent","libs/browser-agent/src/optional/FocusManager","libs/browser-agent/src/optional/KeyboardInputManager","libs/browser-agent/src/optional/PointerInputManager","libs/browser-agent/src/optional/ScrollManager","src/WebGLBridge"],function(exports_20,context_20){"use strict";var Logger_1,initBrowserAgent_1,FocusManager_1,KeyboardInputManager_1,PointerInputManager_1,ScrollManager_1,WebGLBridge_1,VERSION,WebGLWebView;var __moduleName=context_20&&context_20.id;return{setters:[function(e){Logger_1=e},function(e){initBrowserAgent_1=e},function(e){FocusManager_1=e},function(e){KeyboardInputManager_1=e},function(e){PointerInputManager_1=e},function(e){ScrollManager_1=e},function(e){WebGLBridge_1=e}],execute:function(){VERSION="v3.17";Logger_1.default.info("Using Vuplex 2D WebView for WebGL "+VERSION);WebGLWebView=function(){function WebGLWebView(e,t,n,i,r,o){var s=this;this._consoleMessageEventsEnabled=false;this._emitPageLoadStartOnUnload=true;this._focusedInputFieldEventsEnabled=false;this._ignoreDevicePixelRatio=false;this._handleIFrameLoaded=function(){var e;s._emitPageLoadStartOnUnload=true;if(s.canAccessIFrameContent()){var t=(e=s._iframe.contentWindow)===null||e===void 0?void 0:e.window;initBrowserAgent_1.default(new WebGLBridge_1.default(t),{browserAgentOptions:{enableConsoleMessageEvents:s._consoleMessageEventsEnabled,enableFocusedInputFieldEvents:s._focusedInputFieldEventsEnabled,window:t},optionalComponents:{focusManager:new FocusManager_1.default(t),keyboardInputManager:new KeyboardInputManager_1.default({window:t}),pointerInputManager:new PointerInputManager_1.default(t),scrollManager:new ScrollManager_1.default(t)}});t.addEventListener("unload",s._handleIFrameUnloaded)}else{Logger_1.default.warn("The URL loaded is from a different origin, so most of 2D WebView's IWebView APIs will be disabled due to browser limitations. For more info, please see this article: https://support.vuplex.com/articles/webgl-limitations");s._setBackground("white")}s._sendMessage("HandleLoadFinished","")};this._handleIFrameUnloaded=function(){if(s._emitPageLoadStartOnUnload){s._emitPageLoadStarted()}};this._handleWindowMessage=function(e){var t;if(((t=e.data)===null||t===void 0?void 0:t.type)!==WebGLBridge_1.POST_MESSAGE_MESSAGE_TYPE){return}var n=e.data.message;if(n.indexOf("vuplex.webview.pageTransparencyDetermined")!==-1){var i=n.indexOf("true")!==-1;s._setBackground(i?"transparent":"white")}else{s._sendMessage("HandleMessageEmitted",n)}};var a="trial_date";if(a.indexOf("trial")===-1&&new Date>new Date(a)){var u="This trial version of 2D for WebGL has expired.";console.error(u);throw new Error(u)}this._gameObjectName=e;this._ignoreDevicePixelRatio=o;window.addEventListener("message",this._handleWindowMessage);this._iframe=document.createElement("iframe");this._iframe.style.position="fixed";this._iframe.style.zIndex="2147483647";this._iframe.style.border="none";this._iframe.setAttribute("id",e);this._iframe.addEventListener("load",this._handleIFrameLoaded);this.setRect(t,n,i,r);WebGLWebView._unityContainer.appendChild(this._iframe)}WebGLWebView.prototype.canAccessIFrameContent=function(){try{typeof this._iframe.contentWindow._test;return true}catch(e){return false}};WebGLWebView.prototype.canGoBackOrForward=function(){var e,t;if(this.canAccessIFrameContent()){return((t=(e=this._iframe.contentWindow)===null||e===void 0?void 0:e.history.length)!==null&&t!==void 0?t:0)>1}return false};WebGLWebView.prototype.click=function(e,t){var n;if(this.canAccessIFrameContent()){(n=this._vuplexInternal)===null||n===void 0?void 0:n.pointerInputManager.click(e,t)}};WebGLWebView.prototype.destroy=function(){this._emitPageLoadStartOnUnload=false;this._iframe.remove()};WebGLWebView.prototype.executeJavaScript=function(e){if(!this.canAccessIFrameContent()){return""}try{var t=this._iframe.contentWindow.eval(e);return new String(t).toString()}catch(e){return e.toString()}};WebGLWebView.executeJavaScriptLocally=function(javaScript){try{var result=eval(javaScript);return new String(result).toString()}catch(error){return error.toString()}};WebGLWebView.prototype.goBack=function(){var e;if(this.canAccessIFrameContent()){(e=this._iframe.contentWindow)===null||e===void 0?void 0:e.history.back()}};WebGLWebView.prototype.goForward=function(){var e;if(this.canAccessIFrameContent()){(e=this._iframe.contentWindow)===null||e===void 0?void 0:e.history.forward()}};WebGLWebView.prototype.handleKeyboardInput=function(e){var t;if(this.canAccessIFrameContent()){(t=this._vuplexInternal)===null||t===void 0?void 0:t.keyboardInputManager.handleKeyboardInput(e)}};WebGLWebView.prototype.loadHtml=function(e){this._emitPageLoadStartOnUnload=false;this._emitPageLoadStarted();this.loadUrl("data:text/html;charset=utf-8,"+encodeURIComponent(e))};WebGLWebView.prototype.loadUrl=function(e){this._emitPageLoadStartOnUnload=false;this._emitPageLoadStarted();this._iframe.src=e;this._sendMessage("HandleMessageEmitted",JSON.stringify({type:"vuplex.webview.urlChanged",urlAction:{Type:"LOAD",Url:e}}))};WebGLWebView.prototype.postMessage=function(e){var t;(t=this._iframe.contentWindow)===null||t===void 0?void 0:t.postMessage({type:WebGLBridge_1.POST_MESSAGE_MESSAGE_TYPE,message:e},"*")};WebGLWebView.prototype.reload=function(){this._iframe.src+=""};WebGLWebView.prototype.resize=function(e,t){this._iframe.style.width=this._convertPixels(e)+"px";this._iframe.style.height=this._convertPixels(t)+"px"};WebGLWebView.prototype.scroll=function(e,t){var n;if(this.canAccessIFrameContent()){(n=this._iframe.contentWindow)===null||n===void 0?void 0:n.scrollBy(e,t)}};WebGLWebView.prototype.scrollAtPoint=function(e,t,n,i){var r;if(this.canAccessIFrameContent()){(r=this._vuplexInternal)===null||r===void 0?void 0:r.scrollManager.scrollAtPoint(e,t,n,i)}};WebGLWebView.prototype.setConsoleMessageEventsEnabled=function(e){var t;this._consoleMessageEventsEnabled=e;if(this.canAccessIFrameContent()){(t=this._vuplexInternal)===null||t===void 0?void 0:t.browserAgent.setConsoleMessageEventsEnabled(e)}};WebGLWebView.setDevicePixelRatio=function(e){if(e>0){this._devicePixelRatioOverride=e}else{Logger_1.default.error("Invalid value passed to setDevicePixelRatio: "+e)}};WebGLWebView.prototype.setFocused=function(e){var t;if(this.canAccessIFrameContent()){(t=this._vuplexInternal)===null||t===void 0?void 0:t.focusManager.setFocused(e)}};WebGLWebView.prototype.setFocusedInputFieldEventsEnabled=function(e){var t;this._focusedInputFieldEventsEnabled=e;if(this.canAccessIFrameContent()){(t=this._vuplexInternal)===null||t===void 0?void 0:t.browserAgent.setFocusedInputFieldEventsEnabled(e)}};WebGLWebView.prototype.setRect=function(e,t,n,i){this._iframe.style.left=this._convertPixels(e)+"px";this._iframe.style.top=this._convertPixels(t)+"px";this.resize(n,i)};WebGLWebView.setUnityContainerElementId=function(e){this._unityContainerIdOverride=e};WebGLWebView.SetFullscreen=function(e){if(e){var t=this._unityContainer.getElementsByTagName("canvas")[0];if(t){t.style.width="100%";t.style.height="100%"}this._unityContainer.requestFullscreen()}else{document.exitFullscreen()}};WebGLWebView.prototype.setVisible=function(e){this._iframe.style.display=e?"block":"none"};Object.defineProperty(WebGLWebView,"_unityContainer",{get:function(){if(!this._cachedUnityContainer){var e=["unity-container","unityContainer","gameContainer"];if(this._unityContainerIdOverride){e.unshift(this._unityContainerIdOverride)}for(var t=0,n=e;t<n.length;t++){var i=n[t];var r=document.getElementById(i);if(r){this._cachedUnityContainer=r;break}}if(!this._cachedUnityContainer){throw new Error("[2D WebView] Unable to locate the Unity container element! There is no element with the following IDs: "+e.join(", ")+". This is probably because your project is using a WebGL template with a customized container element ID. Please call WebGLWebView.SetUnityContainerElementId() to set the container element for 2D WebView to use.")}}return this._cachedUnityContainer},enumerable:false,configurable:true});Object.defineProperty(WebGLWebView.prototype,"_vuplexInternal",{get:function(){if(this.canAccessIFrameContent()){return this._iframe.contentWindow._vuplexInternal}return null},enumerable:false,configurable:true});WebGLWebView.prototype._convertPixels=function(e){if(this._ignoreDevicePixelRatio){return e}if(WebGLWebView._devicePixelRatioOverride>0){return e/WebGLWebView._devicePixelRatioOverride}if(typeof config==="object"&&config.devicePixelRatio){return e/config.devicePixelRatio}var t=window.devicePixelRatio,n=t===void 0?1:t;return e/n};WebGLWebView.prototype._emitPageLoadStarted=function(){this._sendMessage("HandleLoadStarted","")};WebGLWebView.prototype._sendMessage=function(e,t){SendMessage(this._gameObjectName,e,t)};WebGLWebView.prototype._setBackground=function(e){this._iframe.style.backgroundColor=e};WebGLWebView._cachedUnityContainer=null;WebGLWebView._devicePixelRatioOverride=0;return WebGLWebView}();exports_20("default",WebGLWebView);if(!window.vuplex){window.vuplex={}}window.vuplex.SetFullscreen=WebGLWebView.SetFullscreen.bind(WebGLWebView)}}});System.register("src/WebViewStore",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}e.put=function(e){var t=this._nextInstancePtr++;this._instances[t]=e;return t};e.get=function(e){var t=this._instances[e];if(t){return t}throw new Error("No WebView found for pointer "+e)};e.remove=function(e){delete this._instances[e]};e._instances={};e._nextInstancePtr=1;return e}();e("default",n)}}});System.register("src/index",["src/WebGLWebView","src/WebViewStore"],function(e,t){"use strict";var c,l;var n=t&&t.id;function r(e){var t=lengthBytesUTF8(e)+1;var n=_malloc(t);stringToUTF8(e,n,t);return n}return{setters:[function(e){c=e},function(e){l=e}],execute:function(){_WebView_canGoBack=function(e){};_WebView_canGoForward=function(e){};_WebView_destroyTexture=function(e,t){};_WebView_executeJavaScript=function(e,t,n){};_WebView_loadUrlWithHeaders=function(e,t,n){};_WebView_setRenderingEnabled=function(e,t){};_WebView_zoomIn=function(e){};_WebView_zoomOut=function(e){};_WebView_canAccessIFrameContent=function(e){return l.default.get(e).canAccessIFrameContent()};_WebView_canGoBackOrForward=function(e){return l.default.get(e).canGoBackOrForward()};_WebView_click=function(e,t,n){l.default.get(e).click(t,n)};_WebView_destroy=function(e){l.default.get(e).destroy();l.default.remove(e)};_WebView_executeJavaScriptSync=function(e,t){var n=UTF8ToString(t);var i=l.default.get(e).executeJavaScript(n);return r(i)};_WebView_executeJavaScriptLocally=function(e){var t=UTF8ToString(e);var n=c.default.executeJavaScriptLocally(t);return r(n)};_WebView_goBack=function(e){l.default.get(e).goBack()};_WebView_goForward=function(e){l.default.get(e).goForward()};_WebView_handleKeyboardInput=function(e,t){var n=UTF8ToString(t);l.default.get(e).handleKeyboardInput(n)};_WebView_loadHtml=function(e,t){var n=UTF8ToString(t);l.default.get(e).loadHtml(n)};_WebView_loadUrl=function(e,t){var n=UTF8ToString(t);l.default.get(e).loadUrl(n)};_WebView_newInNative2DMode=function(e,t,n,i,r,o){var s=UTF8ToString(e);var a=new c.default(s,t,n,i,r,o);var u=l.default.put(a);return u};_WebView_postMessage=function(e,t){var n=UTF8ToString(t);l.default.get(e).postMessage(n)};_WebView_reload=function(e){l.default.get(e).reload()};_WebView_resize=function(e,t,n){l.default.get(e).resize(t,n)};_WebView_scroll=function(e,t,n){l.default.get(e).scroll(t,n)};_WebView_scrollAtPoint=function(e,t,n,i,r){l.default.get(e).scrollAtPoint(t,n,i,r)};_WebView_setConsoleMessageEventsEnabled=function(e,t){l.default.get(e).setConsoleMessageEventsEnabled(t)};_WebView_setDevicePixelRatio=function(e){c.default.setDevicePixelRatio(e)};_WebView_setFocused=function(e,t){l.default.get(e).setFocused(t)};_WebView_setFocusedInputFieldEventsEnabled=function(e,t){l.default.get(e).setFocusedInputFieldEventsEnabled(t)};_WebView_setRect=function(e,t,n,i,r){l.default.get(e).setRect(t,n,i,r)};_WebView_setUnityContainerElementId=function(e){var t=UTF8ToString(e);c.default.setUnityContainerElementId(t)};_WebView_setVisible=function(e,t){l.default.get(e).setVisible(t)}}}});System.require("src/index");
`,WebView_canGoBack:function(){},WebView_canGoBack__deps:["$VuplexWebViewImplementation"],WebView_canGoForward:function(){},WebView_canGoForward__deps:["$VuplexWebViewImplementation"],WebView_destroyTexture:function(){},WebView_destroyTexture__deps:["$VuplexWebViewImplementation"],WebView_executeJavaScript:function(){},WebView_executeJavaScript__deps:["$VuplexWebViewImplementation"],WebView_loadUrlWithHeaders:function(){},WebView_loadUrlWithHeaders__deps:["$VuplexWebViewImplementation"],WebView_setRenderingEnabled:function(){},WebView_setRenderingEnabled__deps:["$VuplexWebViewImplementation"],WebView_zoomIn:function(){},WebView_zoomIn__deps:["$VuplexWebViewImplementation"],WebView_zoomOut:function(){},WebView_zoomOut__deps:["$VuplexWebViewImplementation"],WebView_canAccessIFrameContent:function(){},WebView_canAccessIFrameContent__deps:["$VuplexWebViewImplementation"],WebView_canGoBackOrForward:function(){},WebView_canGoBackOrForward__deps:["$VuplexWebViewImplementation"],WebView_click:function(){},WebView_click__deps:["$VuplexWebViewImplementation"],WebView_destroy:function(){},WebView_destroy__deps:["$VuplexWebViewImplementation"],WebView_executeJavaScriptSync:function(){},WebView_executeJavaScriptSync__deps:["$VuplexWebViewImplementation"],WebView_executeJavaScriptLocally:function(){},WebView_executeJavaScriptLocally__deps:["$VuplexWebViewImplementation"],WebView_goBack:function(){},WebView_goBack__deps:["$VuplexWebViewImplementation"],WebView_goForward:function(){},WebView_goForward__deps:["$VuplexWebViewImplementation"],WebView_handleKeyboardInput:function(){},WebView_handleKeyboardInput__deps:["$VuplexWebViewImplementation"],WebView_loadHtml:function(){},WebView_loadHtml__deps:["$VuplexWebViewImplementation"],WebView_loadUrl:function(){},WebView_loadUrl__deps:["$VuplexWebViewImplementation"],WebView_newInNative2DMode:function(){},WebView_newInNative2DMode__deps:["$VuplexWebViewImplementation"],WebView_postMessage:function(){},WebView_postMessage__deps:["$VuplexWebViewImplementation"],WebView_reload:function(){},WebView_reload__deps:["$VuplexWebViewImplementation"],WebView_resize:function(){},WebView_resize__deps:["$VuplexWebViewImplementation"],WebView_scroll:function(){},WebView_scroll__deps:["$VuplexWebViewImplementation"],WebView_scrollAtPoint:function(){},WebView_scrollAtPoint__deps:["$VuplexWebViewImplementation"],WebView_setConsoleMessageEventsEnabled:function(){},WebView_setConsoleMessageEventsEnabled__deps:["$VuplexWebViewImplementation"],WebView_setDevicePixelRatio:function(){},WebView_setDevicePixelRatio__deps:["$VuplexWebViewImplementation"],WebView_setFocused:function(){},WebView_setFocused__deps:["$VuplexWebViewImplementation"],WebView_setFocusedInputFieldEventsEnabled:function(){},WebView_setFocusedInputFieldEventsEnabled__deps:["$VuplexWebViewImplementation"],WebView_setRect:function(){},WebView_setRect__deps:["$VuplexWebViewImplementation"],WebView_setUnityContainerElementId:function(){},WebView_setUnityContainerElementId__deps:["$VuplexWebViewImplementation"],WebView_setVisible:function(){},WebView_setVisible__deps:["$VuplexWebViewImplementation"]});
